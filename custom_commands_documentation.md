# Документация по кастомным командам

## Обзор

Созданы две кастомные команды Django для работы с тестовыми данными:

1. **`populate_test_data`** - создание тестовых данных через ORM
2. **`load_fixtures`** - работа с фикстурами

## Команда populate_test_data

### Описание
Создает тестовые категории и продукты в базе данных с возможностью очистки существующих данных.

### Использование

#### Базовое использование (добавление данных без очистки):
```bash
python manage.py populate_test_data
```

#### Очистка базы данных и добавление новых данных:
```bash
python manage.py populate_test_data --clear
```

#### Добавление только категорий:
```bash
python manage.py populate_test_data --categories-only
```

#### Добавление только продуктов (требует существующих категорий):
```bash
python manage.py populate_test_data --products-only
```

### Параметры

- `--clear` - очистить все существующие данные перед добавлением новых
- `--categories-only` - добавить только категории
- `--products-only` - добавить только продукты

### Создаваемые данные

#### Категории (10 категорий):
1. **Электроника** - товары электронной техники
2. **Одежда** - мужская и женская одежда
3. **Книги** - художественная литература
4. **Спорт** - спортивные товары
5. **Дом и сад** - товары для дома
6. **Красота и здоровье** - косметика и товары для здоровья
7. **Автотовары** - автозапчасти и аксессуары
8. **Игрушки и хобби** - детские игрушки и настольные игры
9. **Продукты питания** - продукты питания и напитки
10. **Мебель** - мебель для дома и офиса

#### Продукты (30 продуктов):
- **Электроника**: iPhone 15 Pro, Dell XPS 13, Sony наушники, iPad Pro
- **Одежда**: футболки, джинсы, кроссовки, куртки
- **Книги**: "Война и мир", "Мастер и Маргарита", "Преступление и наказание"
- **Спорт**: футбольный мяч, велосипед, беговая дорожка
- **Дом и сад**: горшки, инструменты, газонокосилка
- **Красота**: крем для лица, витамины, зубная щетка
- **Авто**: масло, коврики, компрессор
- **Игрушки**: Монополия, LEGO, модель самолета
- **Продукты**: кофе, чай, мед
- **Мебель**: диван, стол, кровать

## Команда load_fixtures

### Описание
Загружает фикстуры с возможностью очистки базы данных и выбора конкретной фикстуры.

### Использование

#### Показать список доступных фикстур:
```bash
python manage.py load_fixtures --list
```

#### Загрузка фикстуры без очистки:
```bash
python manage.py load_fixtures
python manage.py load_fixtures --fixture initial_data
```

#### Очистка и загрузка фикстуры:
```bash
python manage.py load_fixtures --clear
python manage.py load_fixtures --clear --fixture categories
```

#### Загрузка конкретной фикстуры:
```bash
python manage.py load_fixtures --fixture categories
python manage.py load_fixtures --fixture products
```

### Параметры

- `--clear` - очистить базу данных перед загрузкой
- `--fixture` - название фикстуры (по умолчанию: initial_data)
- `--list` - показать список доступных фикстур

### Доступные фикстуры

- `initial_data` - категории + продукты (5 категорий, 6 продуктов)
- `categories` - только категории (8 категорий)
- `products` - только продукты (18 продуктов)

## Сравнение подходов

### populate_test_data (ORM)
**Преимущества:**
- Более гибкий контроль над данными
- Возможность использования сложной логики
- Лучшая производительность для больших объемов данных
- Возможность использования `get_or_create` для избежания дублирования

**Недостатки:**
- Код команды более сложный
- Данные "зашиты" в код

### load_fixtures (JSON)
**Преимущества:**
- Простота создания и редактирования данных
- Возможность версионирования данных
- Легкий обмен данными между проектами
- Стандартный подход Django

**Недостатки:**
- Менее гибкий
- Может быть медленнее для больших объемов данных

## Примеры использования

### Сценарий 1: Полная очистка и загрузка тестовых данных
```bash
# Вариант 1: Через ORM
python manage.py populate_test_data --clear

# Вариант 2: Через фикстуры
python manage.py load_fixtures --clear --fixture initial_data
```

### Сценарий 2: Добавление данных к существующим
```bash
# Добавить только категории
python manage.py populate_test_data --categories-only

# Добавить только продукты
python manage.py populate_test_data --products-only
```

### Сценарий 3: Работа с фикстурами
```bash
# Загрузить только категории
python manage.py load_fixtures --fixture categories

# Загрузить только продукты
python manage.py load_fixtures --fixture products
```

## Проверка результатов

### Через Django shell:
```bash
python manage.py shell
```

```python
from catalog.models import Category, Product

# Статистика
print(f"Категорий: {Category.objects.count()}")
print(f"Продуктов: {Product.objects.count()}")

# Просмотр категорий
for cat in Category.objects.all():
    print(f"{cat.name}: {cat.products.count()} продуктов")

# Просмотр продуктов
for prod in Product.objects.all():
    print(f"{prod.name} - {prod.price} руб. ({prod.category.name})")
```

### Через админ-панель:
1. Запустите сервер: `python manage.py runserver`
2. Откройте: `http://localhost:8000/admin/`
3. Проверьте разделы "Категории" и "Товары"

## Структура файлов

```
catalog/
├── management/
│   ├── __init__.py
│   └── commands/
│       ├── __init__.py
│       ├── populate_test_data.py
│       └── load_fixtures.py
└── fixtures/
    ├── categories.json
    ├── products.json
    └── initial_data.json
```

## Примечания

- Обе команды используют транзакции для обеспечения целостности данных
- Команда `populate_test_data` использует `get_or_create` для избежания дублирования
- Команда `load_fixtures` показывает статистику после загрузки
- Все команды поддерживают цветной вывод для лучшего восприятия
- Данные создаются с реалистичными ценами и описаниями 